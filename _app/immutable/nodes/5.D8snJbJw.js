import"../chunks/Bzak7iHL.js";import"../chunks/DrS1WK7l.js";import{o as Qa,a as Va}from"../chunks/D-KRtMmF.js";import{h as ka,a1 as Xa,a2 as na,a3 as Ya,a4 as g,al as Za,a9 as p,aa as ae,w as a,v as _,a7 as w,x as v,am as ee,a8 as s,ad as r,a5 as o,ak as xa,a6 as wa,ae as te,u as l}from"../chunks/BaFMXX1b.js";import{a as n,e as P}from"../chunks/CcETWVYL.js";import{i as L}from"../chunks/BsF4dGg2.js";import{p as se,R as re,e as $a,i as Ia}from"../chunks/M787uHq2.js";import{t as oe}from"../chunks/BkCE2b-i.js";import{i as ie}from"../chunks/BDHLh8UG.js";import{s as de,a as le}from"../chunks/23JgfLWk.js";import{g as M,b as F}from"../chunks/CJ4O2v7I.js";import{i as ne}from"../chunks/BigBxC9G.js";function ja(b,ca,$,G,va,u){var y=b.__className;if(ka||y!==$||y===void 0){var h=oe($,G);(!ka||h!==b.getAttribute("class"))&&(h==null?b.removeAttribute("class"):b.className=h),b.__className=$}return u}const ce=!1,Ee=Object.freeze(Object.defineProperty({__proto__:null,ssr:ce},Symbol.toStringTag,{value:"Module"}));var ve=g('<div class="error-screen svelte-ac1dd4"><div class="error-icon svelte-ac1dd4">‚ùå</div> <h2 class="svelte-ac1dd4">Connection Failed</h2> <p class="svelte-ac1dd4"> </p> <button class="btn-primary svelte-ac1dd4">Back to Menu</button></div>'),me=g('<div class="loading-screen svelte-ac1dd4"><div class="loading-spinner svelte-ac1dd4"></div> <h2 class="svelte-ac1dd4"> </h2> <p class="svelte-ac1dd4">Setting up multiplayer connection</p></div>'),pe=g('<div><div class="player-avatar svelte-ac1dd4"> </div> <div class="player-info svelte-ac1dd4"><span class="player-name svelte-ac1dd4"> </span> <span class="player-role svelte-ac1dd4"> </span></div> <div class="connection-status svelte-ac1dd4"> </div></div>'),ue=g('<div class="player-card empty svelte-ac1dd4"><div class="player-avatar svelte-ac1dd4">üë§</div> <div class="player-info svelte-ac1dd4"><span class="player-name svelte-ac1dd4">Waiting for player...</span></div></div>'),_e=g('<button class="btn-primary start-btn svelte-ac1dd4"> </button>'),ge=g('<div class="waiting-message svelte-ac1dd4"><span class="pulse-dot svelte-ac1dd4"></span> Waiting for host to start the race...</div>'),fe=g('<div class="share-section svelte-ac1dd4"><h4 class="svelte-ac1dd4">Invite Friends</h4> <p class="svelte-ac1dd4">Share this room with your friends so they can join:</p> <div class="share-text svelte-ac1dd4"><div class="svelte-ac1dd4"><strong class="svelte-ac1dd4">ID:</strong> </div> <div style="margin-top: .5rem; word-break: break-all;" class="svelte-ac1dd4"><strong class="svelte-ac1dd4">Link:</strong> </div></div> <div class="lobby-actions svelte-ac1dd4" style="margin-top: 1rem;"><button class="btn-secondary svelte-ac1dd4"> </button> <button class="btn-secondary svelte-ac1dd4"> </button></div></div>'),be=g('<div class="lobby-content svelte-ac1dd4"><div class="room-header svelte-ac1dd4"><h1 class="svelte-ac1dd4">üèÅ Racing Lobby</h1> <div class="room-info svelte-ac1dd4"><div class="room-id svelte-ac1dd4"><span class="label svelte-ac1dd4">Room ID:</span> <div class="id-container svelte-ac1dd4"><span class="room-code svelte-ac1dd4"> </span> <button class="copy-btn svelte-ac1dd4" title="Copy Room ID"> </button></div></div> <div> </div></div></div> <div class="players-section svelte-ac1dd4"><h3 class="svelte-ac1dd4"> </h3> <div class="players-list svelte-ac1dd4"><!> <!></div></div> <div class="game-settings svelte-ac1dd4"><h3 class="svelte-ac1dd4">Game Settings</h3> <div class="settings-grid svelte-ac1dd4"><div class="setting-item svelte-ac1dd4"><span class="label svelte-ac1dd4">Track:</span> <span class="svelte-ac1dd4">Default Track</span></div> <div class="setting-item svelte-ac1dd4"><span class="label svelte-ac1dd4">Mode:</span> <span class="svelte-ac1dd4">Sunny</span></div> <div class="setting-item svelte-ac1dd4"><span class="label svelte-ac1dd4">Max Players:</span> <span class="svelte-ac1dd4"> </span></div></div></div> <div class="lobby-actions svelte-ac1dd4"><!> <button class="btn-secondary svelte-ac1dd4">Leave Room</button></div> <!></div>'),ye=g('<div class="lobby-container svelte-ac1dd4"><!></div>');function Le(b,ca){Xa(ca,!1);const $=()=>le(se,"$page",G),[G,va]=de(),u=_(),y=_(),h=_();let c,t=_(null),R=_(!1),N="",W=_(!1),T=_(""),Ca=[],O=_(!1),J=_(!1),U=!1;Qa(async()=>{if(N=localStorage.getItem("playerName")||"Anonymous",!ne()){v(T,"Firebase not configured. Multiplayer is unavailable.");return}c=new re,v(W,!0);try{a(y)?await Sa():await Pa()}catch(e){console.error("Room operation failed:",e),v(T,e instanceof Error?e.message:"Failed to connect to room")}finally{v(W,!1)}}),Va(()=>{c&&!U&&c.leaveRoom()});async function Sa(){try{const e=await c.createRoom(N);v(t,c.getCurrentRoom()),v(R,!0),console.log("Room created:",e),ma(),M(`${F}/lobby/${e}`,{replaceState:!0})}catch(e){throw new Error("Failed to create room: "+(e instanceof Error?e.message:"Unknown error"))}}async function Pa(){try{if(!a(u)||a(u)==="create")throw new Error("Invalid room link. Please create a new room or check the room ID.");if(await c.joinRoom(a(u),N),v(t,c.getCurrentRoom()),!a(t))throw new Error("Room not found or no longer available");console.log("Joined room:",a(t).id),ma()}catch(e){throw new Error("Failed to join room: "+(e instanceof Error?e.message:"Unknown error"))}}function ma(){c&&(c.onPlayerJoin(e=>{console.log("Realtime join:",e)}),c.onPlayerLeave(e=>{console.log("Realtime leave:",e)}),c.onRoomError(e=>{console.error("Room error:",e)}),c.onRoomUpdate(e=>{v(t,e),e&&e.status==="racing"&&(U=!0,M(`${F}/game/multiplayer/${e==null?void 0:e.id}`))}))}function pa(){var e;(e=a(t))!=null&&e.id&&(navigator.clipboard.writeText(a(t).id),v(O,!0),setTimeout(()=>v(O,!1),1500))}function Da(){var e;if((e=a(t))!=null&&e.id){const f=`${location.origin}/lobby/${a(t).id}`;navigator.clipboard.writeText(f),v(J,!0),setTimeout(()=>v(J,!1),1500)}}async function Ea(){a(R)&&a(t)&&(U=!0,await c.startGame(),M(`${F}/game/multiplayer/${a(t).id}`))}function La(){c&&c.leaveRoom(),M(`${F}/`)}na(()=>$(),()=>{v(u,$().params.roomId)}),na(()=>a(u),()=>{v(y,a(u)==="create")}),na(()=>(a(R),a(t)),()=>{v(h,a(R)&&a(t)&&Object.keys(a(t).players).length>=2)}),Ya(),ie();var z=ye();Za(e=>{w(()=>ee.title=`
    ${a(y)?"Creating Room":`Room ${a(u)}`} - Speed Racers
  `)});var Ma=s(z);{var Fa=e=>{var f=ve(),D=o(s(f),4),B=s(D,!0);r(D);var q=o(D,2);r(f),w(()=>n(B,a(T))),P("click",q,()=>M(`${F}/`)),p(e,f)},Ta=e=>{var f=xa(),D=wa(f);{var B=I=>{var j=me(),A=o(s(j),2),K=s(A,!0);r(A),te(2),r(j),w(()=>n(K,a(y)?"Creating Room...":"Joining Room...")),p(I,j)},q=I=>{var j=xa(),A=wa(j);{var K=Q=>{var V=be(),X=s(V),ua=o(s(X),2),Y=s(ua),_a=o(s(Y),2),Z=s(_a),Oa=s(Z,!0);r(Z);var aa=o(Z,2),Aa=s(aa,!0);r(aa),r(_a),r(Y);var ea=o(Y,2),Ha=s(ea,!0);r(ea),r(ua),r(X);var ta=o(X,2),sa=s(ta),Ga=s(sa);r(sa);var ga=o(sa,2),fa=s(ga);$a(fa,1,()=>(a(t),l(()=>Object.values(a(t).players))),Ia,(d,i)=>{var m=pe(),k=s(m),ia=s(k,!0);r(k);var C=o(k,2),E=s(C),H=s(E,!0);r(E);var x=o(E,2),da=s(x,!0);r(x),r(C);var S=o(C,2),la=s(S,!0);r(S),r(m),w(Ka=>{ja(m,1,`player-card ${a(i),l(()=>a(i).isHost?"host":"")??""}`,"svelte-ac1dd4"),n(ia,(a(i),l(()=>a(i).isHost?"üëë":"üèéÔ∏è"))),n(H,(a(i),l(()=>a(i).name||"Anonymous"))),n(da,(a(i),l(()=>a(i).isHost?"Host":"Player"))),n(la,Ka)},[()=>(a(i),l(()=>Ca.includes(a(i).id)||a(i).isHost?"üü¢":"üî¥"))]),p(d,m)});var Na=o(fa,2);$a(Na,1,()=>(a(t),l(()=>Array(4-Object.keys(a(t).players).length))),Ia,(d,i)=>{var m=ue();p(d,m)}),r(ga),r(ta);var ra=o(ta,2),ba=o(s(ra),2),ya=o(s(ba),4),ha=o(s(ya),2),Wa=s(ha,!0);r(ha),r(ya),r(ba),r(ra);var oa=o(ra,2),Ra=s(oa);{var Ja=d=>{var i=_e(),m=s(i,!0);r(i),w(()=>{i.disabled=!a(h),n(m,a(h)?"üöÄ Start Race":"Waiting for Players...")}),P("click",i,Ea),p(d,i)},Ua=d=>{var i=ge();p(d,i)};L(Ra,d=>{a(R)?d(Ja):d(Ua,!1)})}var za=o(Ra,2);r(oa);var Ba=o(oa,2);{var qa=d=>{var i=fe(),m=o(s(i),4),k=s(m),ia=o(s(k));r(k);var C=o(k,2),E=o(s(C));r(C),r(m);var H=o(m,2),x=s(H),da=s(x,!0);r(x);var S=o(x,2),la=s(S,!0);r(S),r(H),r(i),w(()=>{n(ia,` ${a(t),l(()=>a(t).id)??""}`),n(E,` ${l(()=>location.origin)??""}/lobby/${a(t),l(()=>a(t).id)??""}`),n(da,a(O)?"‚úÖ ID Copied":"Copy ID"),n(la,a(J)?"‚úÖ Link Copied":"Copy Link")}),P("click",x,pa),P("click",S,Da),p(d,i)};L(Ba,d=>{a(R),a(t),l(()=>a(R)&&Object.keys(a(t).players).length===1)&&d(qa)})}r(V),w(d=>{n(Oa,(a(t),l(()=>a(t).id))),n(Aa,a(O)?"‚úÖ":"üìã"),ja(ea,1,`status-badge ${a(t),l(()=>a(t).status)??""}`,"svelte-ac1dd4"),n(Ha,(a(t),l(()=>a(t).status==="waiting"?"‚è≥ Waiting":a(t).status==="racing"?"üèÅ Racing":"üèÜ Finished"))),n(Ga,`Players (${d??""}/4)`),n(Wa,(a(t),l(()=>a(t).maxPlayers)))},[()=>(a(t),l(()=>Object.keys(a(t).players).length))]),P("click",aa,pa),P("click",za,La),p(Q,V)};L(A,Q=>{a(t)&&Q(K)},!0)}p(I,j)};L(D,I=>{a(W)?I(B):I(q,!1)},!0)}p(e,f)};L(Ma,e=>{a(T)?e(Fa):e(Ta,!1)})}r(z),p(b,z),ae(),va()}export{Le as component,Ee as universal};
