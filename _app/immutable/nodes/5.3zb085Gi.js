import"../chunks/Bzak7iHL.js";import"../chunks/DrS1WK7l.js";import{o as Ka,a as Qa}from"../chunks/D-KRtMmF.js";import{h as Ra,a1 as Va,a2 as la,a3 as Xa,a4 as g,al as Ya,a9 as p,aa as Za,w as a,v as _,a7 as w,x as v,am as ae,a8 as s,ad as r,a5 as o,ak as ka,a6 as xa,ae as ee,u as l}from"../chunks/BaFMXX1b.js";import{a as n,e as P}from"../chunks/CcETWVYL.js";import{i as L}from"../chunks/BsF4dGg2.js";import{p as te,R as se,e as wa,i as $a}from"../chunks/HIql3zGl.js";import{t as re}from"../chunks/BkCE2b-i.js";import{i as oe}from"../chunks/BDHLh8UG.js";import{s as ie,a as de}from"../chunks/23JgfLWk.js";import{g as M}from"../chunks/DMQ9Tk2x.js";import{i as le}from"../chunks/BigBxC9G.js";function Ia(b,na,$,H,ca,u){var y=b.__className;if(Ra||y!==$||y===void 0){var h=re($,H);(!Ra||h!==b.getAttribute("class"))&&(h==null?b.removeAttribute("class"):b.className=h),b.__className=$}return u}const ne=!1,De=Object.freeze(Object.defineProperty({__proto__:null,ssr:ne},Symbol.toStringTag,{value:"Module"}));var ce=g('<div class="error-screen svelte-ac1dd4"><div class="error-icon svelte-ac1dd4">‚ùå</div> <h2 class="svelte-ac1dd4">Connection Failed</h2> <p class="svelte-ac1dd4"> </p> <button class="btn-primary svelte-ac1dd4">Back to Menu</button></div>'),ve=g('<div class="loading-screen svelte-ac1dd4"><div class="loading-spinner svelte-ac1dd4"></div> <h2 class="svelte-ac1dd4"> </h2> <p class="svelte-ac1dd4">Setting up multiplayer connection</p></div>'),me=g('<div><div class="player-avatar svelte-ac1dd4"> </div> <div class="player-info svelte-ac1dd4"><span class="player-name svelte-ac1dd4"> </span> <span class="player-role svelte-ac1dd4"> </span></div> <div class="connection-status svelte-ac1dd4"> </div></div>'),pe=g('<div class="player-card empty svelte-ac1dd4"><div class="player-avatar svelte-ac1dd4">üë§</div> <div class="player-info svelte-ac1dd4"><span class="player-name svelte-ac1dd4">Waiting for player...</span></div></div>'),ue=g('<button class="btn-primary start-btn svelte-ac1dd4"> </button>'),_e=g('<div class="waiting-message svelte-ac1dd4"><span class="pulse-dot svelte-ac1dd4"></span> Waiting for host to start the race...</div>'),ge=g('<div class="share-section svelte-ac1dd4"><h4 class="svelte-ac1dd4">Invite Friends</h4> <p class="svelte-ac1dd4">Share this room with your friends so they can join:</p> <div class="share-text svelte-ac1dd4"><div class="svelte-ac1dd4"><strong class="svelte-ac1dd4">ID:</strong> </div> <div style="margin-top: .5rem; word-break: break-all;" class="svelte-ac1dd4"><strong class="svelte-ac1dd4">Link:</strong> </div></div> <div class="lobby-actions svelte-ac1dd4" style="margin-top: 1rem;"><button class="btn-secondary svelte-ac1dd4"> </button> <button class="btn-secondary svelte-ac1dd4"> </button></div></div>'),fe=g('<div class="lobby-content svelte-ac1dd4"><div class="room-header svelte-ac1dd4"><h1 class="svelte-ac1dd4">üèÅ Racing Lobby</h1> <div class="room-info svelte-ac1dd4"><div class="room-id svelte-ac1dd4"><span class="label svelte-ac1dd4">Room ID:</span> <div class="id-container svelte-ac1dd4"><span class="room-code svelte-ac1dd4"> </span> <button class="copy-btn svelte-ac1dd4" title="Copy Room ID"> </button></div></div> <div> </div></div></div> <div class="players-section svelte-ac1dd4"><h3 class="svelte-ac1dd4"> </h3> <div class="players-list svelte-ac1dd4"><!> <!></div></div> <div class="game-settings svelte-ac1dd4"><h3 class="svelte-ac1dd4">Game Settings</h3> <div class="settings-grid svelte-ac1dd4"><div class="setting-item svelte-ac1dd4"><span class="label svelte-ac1dd4">Track:</span> <span class="svelte-ac1dd4">Default Track</span></div> <div class="setting-item svelte-ac1dd4"><span class="label svelte-ac1dd4">Mode:</span> <span class="svelte-ac1dd4">Sunny</span></div> <div class="setting-item svelte-ac1dd4"><span class="label svelte-ac1dd4">Max Players:</span> <span class="svelte-ac1dd4"> </span></div></div></div> <div class="lobby-actions svelte-ac1dd4"><!> <button class="btn-secondary svelte-ac1dd4">Leave Room</button></div> <!></div>'),be=g('<div class="lobby-container svelte-ac1dd4"><!></div>');function Ee(b,na){Va(na,!1);const $=()=>de(te,"$page",H),[H,ca]=ie(),u=_(),y=_(),h=_();let c,t=_(null),R=_(!1),G="",N=_(!1),F=_(""),ja=[],T=_(!1),W=_(!1),J=!1;Ka(async()=>{if(G=localStorage.getItem("playerName")||"Anonymous",!le()){v(F,"Firebase not configured. Multiplayer is unavailable.");return}c=new se,v(N,!0);try{a(y)?await Ca():await Sa()}catch(e){console.error("Room operation failed:",e),v(F,e instanceof Error?e.message:"Failed to connect to room")}finally{v(N,!1)}}),Qa(()=>{c&&!J&&c.leaveRoom()});async function Ca(){try{const e=await c.createRoom(G);v(t,c.getCurrentRoom()),v(R,!0),console.log("Room created:",e),va(),M(`/lobby/${e}`,{replaceState:!0})}catch(e){throw new Error("Failed to create room: "+(e instanceof Error?e.message:"Unknown error"))}}async function Sa(){try{if(!a(u)||a(u)==="create")throw new Error("Invalid room link. Please create a new room or check the room ID.");if(await c.joinRoom(a(u),G),v(t,c.getCurrentRoom()),!a(t))throw new Error("Room not found or no longer available");console.log("Joined room:",a(t).id),va()}catch(e){throw new Error("Failed to join room: "+(e instanceof Error?e.message:"Unknown error"))}}function va(){c&&(c.onPlayerJoin(e=>{console.log("Realtime join:",e)}),c.onPlayerLeave(e=>{console.log("Realtime leave:",e)}),c.onRoomError(e=>{console.error("Room error:",e)}),c.onRoomUpdate(e=>{v(t,e),e&&e.status==="racing"&&(J=!0,M(`/game/multiplayer/${e==null?void 0:e.id}`))}))}function ma(){var e;(e=a(t))!=null&&e.id&&(navigator.clipboard.writeText(a(t).id),v(T,!0),setTimeout(()=>v(T,!1),1500))}function Pa(){var e;if((e=a(t))!=null&&e.id){const f=`${location.origin}/lobby/${a(t).id}`;navigator.clipboard.writeText(f),v(W,!0),setTimeout(()=>v(W,!1),1500)}}async function Da(){a(R)&&a(t)&&(J=!0,await c.startGame(),M(`/game/multiplayer/${a(t).id}`))}function Ea(){c&&c.leaveRoom(),M("/")}la(()=>$(),()=>{v(u,$().params.roomId)}),la(()=>a(u),()=>{v(y,a(u)==="create")}),la(()=>(a(R),a(t)),()=>{v(h,a(R)&&a(t)&&Object.keys(a(t).players).length>=2)}),Xa(),oe();var U=be();Ya(e=>{w(()=>ae.title=`
    ${a(y)?"Creating Room":`Room ${a(u)}`} - Speed Racers
  `)});var La=s(U);{var Ma=e=>{var f=ce(),D=o(s(f),4),z=s(D,!0);r(D);var B=o(D,2);r(f),w(()=>n(z,a(F))),P("click",B,()=>M("/")),p(e,f)},Fa=e=>{var f=ka(),D=xa(f);{var z=I=>{var j=ve(),O=o(s(j),2),q=s(O,!0);r(O),ee(2),r(j),w(()=>n(q,a(y)?"Creating Room...":"Joining Room...")),p(I,j)},B=I=>{var j=ka(),O=xa(j);{var q=K=>{var Q=fe(),V=s(Q),pa=o(s(V),2),X=s(pa),ua=o(s(X),2),Y=s(ua),Ta=s(Y,!0);r(Y);var Z=o(Y,2),Oa=s(Z,!0);r(Z),r(ua),r(X);var aa=o(X,2),Aa=s(aa,!0);r(aa),r(pa),r(V);var ea=o(V,2),ta=s(ea),Ha=s(ta);r(ta);var _a=o(ta,2),ga=s(_a);wa(ga,1,()=>(a(t),l(()=>Object.values(a(t).players))),$a,(d,i)=>{var m=me(),k=s(m),oa=s(k,!0);r(k);var C=o(k,2),E=s(C),A=s(E,!0);r(E);var x=o(E,2),ia=s(x,!0);r(x),r(C);var S=o(C,2),da=s(S,!0);r(S),r(m),w(qa=>{Ia(m,1,`player-card ${a(i),l(()=>a(i).isHost?"host":"")??""}`,"svelte-ac1dd4"),n(oa,(a(i),l(()=>a(i).isHost?"üëë":"üèéÔ∏è"))),n(A,(a(i),l(()=>a(i).name||"Anonymous"))),n(ia,(a(i),l(()=>a(i).isHost?"Host":"Player"))),n(da,qa)},[()=>(a(i),l(()=>ja.includes(a(i).id)||a(i).isHost?"üü¢":"üî¥"))]),p(d,m)});var Ga=o(ga,2);wa(Ga,1,()=>(a(t),l(()=>Array(4-Object.keys(a(t).players).length))),$a,(d,i)=>{var m=pe();p(d,m)}),r(_a),r(ea);var sa=o(ea,2),fa=o(s(sa),2),ba=o(s(fa),4),ya=o(s(ba),2),Na=s(ya,!0);r(ya),r(ba),r(fa),r(sa);var ra=o(sa,2),ha=s(ra);{var Wa=d=>{var i=ue(),m=s(i,!0);r(i),w(()=>{i.disabled=!a(h),n(m,a(h)?"üöÄ Start Race":"Waiting for Players...")}),P("click",i,Da),p(d,i)},Ja=d=>{var i=_e();p(d,i)};L(ha,d=>{a(R)?d(Wa):d(Ja,!1)})}var Ua=o(ha,2);r(ra);var za=o(ra,2);{var Ba=d=>{var i=ge(),m=o(s(i),4),k=s(m),oa=o(s(k));r(k);var C=o(k,2),E=o(s(C));r(C),r(m);var A=o(m,2),x=s(A),ia=s(x,!0);r(x);var S=o(x,2),da=s(S,!0);r(S),r(A),r(i),w(()=>{n(oa,` ${a(t),l(()=>a(t).id)??""}`),n(E,` ${l(()=>location.origin)??""}/lobby/${a(t),l(()=>a(t).id)??""}`),n(ia,a(T)?"‚úÖ ID Copied":"Copy ID"),n(da,a(W)?"‚úÖ Link Copied":"Copy Link")}),P("click",x,ma),P("click",S,Pa),p(d,i)};L(za,d=>{a(R),a(t),l(()=>a(R)&&Object.keys(a(t).players).length===1)&&d(Ba)})}r(Q),w(d=>{n(Ta,(a(t),l(()=>a(t).id))),n(Oa,a(T)?"‚úÖ":"üìã"),Ia(aa,1,`status-badge ${a(t),l(()=>a(t).status)??""}`,"svelte-ac1dd4"),n(Aa,(a(t),l(()=>a(t).status==="waiting"?"‚è≥ Waiting":a(t).status==="racing"?"üèÅ Racing":"üèÜ Finished"))),n(Ha,`Players (${d??""}/4)`),n(Na,(a(t),l(()=>a(t).maxPlayers)))},[()=>(a(t),l(()=>Object.keys(a(t).players).length))]),P("click",Z,ma),P("click",Ua,Ea),p(K,Q)};L(O,K=>{a(t)&&K(q)},!0)}p(I,j)};L(D,I=>{a(N)?I(z):I(B,!1)},!0)}p(e,f)};L(La,e=>{a(F)?e(Ma):e(Fa,!1)})}r(U),p(b,U),Za(),ca()}export{Ee as component,De as universal};
