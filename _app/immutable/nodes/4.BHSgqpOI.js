var Ce=Object.defineProperty;var Ae=(R,e,t)=>e in R?Ce(R,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):R[e]=t;var l=(R,e,t)=>Ae(R,typeof e!="symbol"?e+"":e,t);import"../chunks/Bzak7iHL.js";import"../chunks/BAWEk33w.js";import{g as we,o as De,b as Pe,a as O}from"../chunks/DeGFAstr.js";import{n as ke,o as ce,t as N,a6 as He,aD as Le,aE as We,a7 as q,a8 as Q,aC as ye,a9 as $e,aa as P,ab as G,A as i,M as H,N as z,af as Ue,ac as B,u as ge}from"../chunks/CLtiFm-Q.js";import{i as ne}from"../chunks/DgQJhhFg.js";import{I as Fe,e as Ne,i as Ve}from"../chunks/5XbaB0mK.js";import{s as ve}from"../chunks/Blh6K_Xk.js";import{b as Oe}from"../chunks/CyGP8b_B.js";import{i as Ze}from"../chunks/V_1rYtVp.js";import{l as qe,s as Xe,a as je,b as Ye}from"../chunks/rTWVmEA1.js";import{R as Qe,p as Je}from"../chunks/CFwWZZYi.js";import{S as Ke,P as et,W as tt,C as st,a as at,I as it,R as nt,b as ot,c as rt,E as lt,T as ct,d as ht,e as be,A as dt,M as $,V as J,Q as pt,f as oe,L as ut,g as ft,h as mt,G as wt,i as re,B as Se,j as K,k as yt,l as Me,D as gt,H as vt,m as bt,n as St,o as Mt}from"../chunks/BQjzqC9-.js";import{s as le}from"../chunks/prV4TT54.js";import{b as kt}from"../chunks/B6mXda80.js";import{H as zt}from"../chunks/DqfAMrUR.js";import{s as xt}from"../chunks/OnIyTPbP.js";function It(R,e){const t=qe(e,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const s=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18"}],["path",{d:"M4 22h16"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6"}]];Fe(R,Xe({name:"trophy"},()=>t,{get iconNode(){return s},children:(a,o)=>{var u=ke(),n=ce(u);xt(n,e,"default",{}),N(a,u)},$$slots:{default:!0}}))}class _t{constructor(e,t){l(this,"scene");l(this,"camera");l(this,"renderer");l(this,"clock");l(this,"physics");l(this,"input");l(this,"renderSystem");l(this,"chaseCamera");l(this,"environment");l(this,"track");l(this,"audio");l(this,"collision");l(this,"gameMode");l(this,"running",!1);l(this,"disposeBag",[]);l(this,"frameTimeBuffer",[]);l(this,"frameTimeBufferSize",5);l(this,"players",new Map);l(this,"localId");l(this,"countdown",3);l(this,"countdownStartAt",null);l(this,"raceStarted",!1);l(this,"finishZ",600);l(this,"winnerId",null);l(this,"frozen",!1);l(this,"finishGate");l(this,"finishGateBannerMat");l(this,"throttleInput",0);l(this,"muted",!1);l(this,"currentSpeed",0);l(this,"loop",()=>{if(!this.running)return;const e=this.clock.getDelta(),t=Math.min(e,.1);this.frameTimeBuffer.push(t),this.frameTimeBuffer.length>this.frameTimeBufferSize&&this.frameTimeBuffer.shift();const s=this.frameTimeBuffer.reduce((a,o)=>a+o,0)/this.frameTimeBuffer.length;this.update(s),this.render(),requestAnimationFrame(this.loop)});l(this,"updateSize",()=>{const e=window.innerWidth,t=window.innerHeight;this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t,!1),this.renderer.setPixelRatio(Math.min(devicePixelRatio,2)),this.renderSystem.updateSize&&this.renderSystem.updateSize(e,t)});var a;this.container=e,this.scene=new Ke,this.camera=new et(60,1,.1,1e3),this.camera.position.set(0,8,15),this.camera.lookAt(0,0,0),this.renderer=new tt({antialias:!0,alpha:!1}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.clock=new st,this.physics=new at,this.input=new it(e),this.renderSystem=new nt(this.scene,this.camera,this.renderer),this.chaseCamera=new ot(this.camera);const s=t.find(o=>o.isLocal);this.localId=s?s.id:(a=t[0])==null?void 0:a.id,t.forEach(o=>{this.players.set(o.id,{info:o,car:null,label:null})})}init(e){const t=we(le);this.renderer.setPixelRatio(Math.min(devicePixelRatio,t.graphics.resolution)),this.renderer.shadowMap.enabled=!!t.graphics.shadows,this.renderer.shadowMap.type=rt,this.updateSize(),this.container.appendChild(this.renderer.domElement),window.addEventListener("resize",this.updateSize),this.disposeBag.push(()=>window.removeEventListener("resize",this.updateSize)),this.initializeGameMode(t.gameplay.gameMode),this.environment=new lt(this.renderer),this.environment.setup(this.scene),this.scene.add(this.environment.group),this.track=new ct,this.scene.add(this.track.group),this.collision=new ht(this.track.obstacles),this.createOrUpdateFinishGate(),Array.from(this.players.keys()).forEach(h=>{const m=new be({mass:1200,maxSpeed:40,acceleration:32,braking:60,handling:2.2,drag:.8,lateralGrip:8,reverseScale:.45,handbrakeGrip:.2,boost:{multiplier:1.35,capacity:6,drain:.45,regen:.22}});m.setPosition(0,0,0),m.setHeading(0),this.scene.add(m.group);const d=this.createNameLabel(this.players.get(h).info.name);m.group.add(d),d.position.set(0,1.8,0),this.players.set(h,{...this.players.get(h),car:m,label:d})}),this.relineUpGrid(),this.audio=new dt(this.camera),this.applySettingsToAudio();const a=le.subscribe(()=>this.applySettingsToAudio());this.disposeBag.push(()=>a());const o=async()=>{var h;await((h=this.audio)==null?void 0:h.resume()),window.removeEventListener("keydown",o,!0),window.removeEventListener("pointerdown",o,!0),this.disposeBag=this.disposeBag.filter(m=>m!==u)},u=()=>{window.removeEventListener("keydown",o,!0),window.removeEventListener("pointerdown",o,!0)};window.addEventListener("keydown",o,!0),window.addEventListener("pointerdown",o,!0),this.disposeBag.push(u);const n=this.players.get(this.localId).car;this.chaseCamera.update(0,n.group),this.running=!0,this.clock.start(),this.loop(),e?this.countdownStartAt=e:this.countdownStartAt=Date.now()}update(e){var M,v,y,w;if(this.frozen)return;this.physics.update(e);const t=this.players.get(this.localId);if(!this.raceStarted&&this.countdownStartAt){const c=(Date.now()-this.countdownStartAt)/1e3;this.countdown=Math.max(0,3-Math.floor(c)),c>=3&&(this.raceStarted=!0)}if(this.raceStarted){const c=Number(this.input.isDown("ArrowUp")||this.input.isDown("KeyW")),g=Number(this.input.isDown("ArrowDown")||this.input.isDown("KeyS")),k=this.input.isDown("Space"),x=this.input.isDown("ShiftLeft")||this.input.isDown("ShiftRight"),b=$.clamp(this.input.getSteerValue(),-1,1);t.car.setInputs({throttle:c,brake:g,steering:b,handbrake:k,boost:x}),this.throttleInput=c}else t.car.setInputs({throttle:0,brake:1,steering:0,handbrake:!0,boost:!1}),this.throttleInput=0;if(this.players.forEach(({car:c})=>c.update(e)),this.currentSpeed=t.car.getSpeed(),this.chaseCamera.update(e,t.car.group),this.resolveLocalCarCollisions(),(M=this.audio)==null||M.setEngine(this.throttleInput,this.currentSpeed,t.car.config.maxSpeed),this.track.update(t.car.group.position.z),(v=this.environment)==null||v.update(t.car.group.position.z),(y=this.gameMode)==null||y.updateEnvironment(e,t.car.group.position),this.finishGate&&this.finishGateBannerMat){const c=this.finishZ-t.car.group.position.z;if(c<=0)this.finishGateBannerMat.opacity=1,this.finishGate.visible=!0;else if(c<160){const g=1-c/160;this.finishGateBannerMat.opacity=$.clamp(.12+.88*g,.12,1),this.finishGate.visible=!0}else this.finishGateBannerMat.opacity=.12,this.finishGate.visible=!1}const s=this.camera.position;this.players.forEach(({car:c,label:g})=>{var U;if(!g)return;const k=s.distanceTo(c.group.position),x=8,I=$.clamp((k-x)/(45-x),0,1),_=$.lerp(1,.65,I),A=((U=g.userData)==null?void 0:U.baseScale)||{w:1.05,h:.35};g.scale.set(A.w*_,A.h*_,1);const D=g.material;D&&(D.opacity=$.lerp(1,.85,I))});const a=t.car.group.position,o=.6,u=1.2,n={minX:a.x-o,maxX:a.x+o,minZ:a.z-u,maxZ:a.z+u},h=t.car.getVelocityRef().clone();if(this.collision.resolve(a,t.car.getVelocityRef(),n)){const c=t.car.getVelocityRef(),g=h.clone().sub(c),k=$.clamp(g.length()*.1,0,1);(w=this.audio)==null||w.playCollision(k)}const d=25;if(Math.abs(a.x)>d&&(a.x=$.clamp(a.x,-d,d)),!this.winnerId){for(const[c,g]of this.players)if(g.car.group.position.z>=this.finishZ){this.winnerId=c;break}}}render(){this.renderSystem.render()}resolveLocalCarCollisions(){var m;const e=this.players.get(this.localId);if(!e)return;const t=e.car.group.position,s=e.car.getVelocityRef(),o=.7*2,u=o*o,n=new J;let h=0;if(this.players.forEach((d,M)=>{if(M===this.localId)return;const v=d.car.group.position;n.copy(v).sub(t);const y=n.x,w=n.z,c=y*y+w*w;if(c>0&&c<u){const g=Math.sqrt(c)||1e-6,k=new J(y/g,0,w/g),x=o-g;t.addScaledVector(k,-x);const b=s.dot(k);b>0&&(s.addScaledVector(k,-1.2*b),h+=Math.abs(b))}}),h>0){const d=$.clamp(h*.15,0,1);(m=this.audio)==null||m.playCollision(d)}}destroy(){var e,t,s;this.running=!1,this.clock.stop(),this.disposeBag.forEach(a=>a()),(e=this.gameMode)==null||e.dispose(),(t=this.environment)==null||t.dispose(this.scene),this.renderer.dispose(),this.input.destroy(),(s=this.audio)==null||s.destroy(),this.renderer.domElement.parentElement===this.container&&this.container.removeChild(this.renderer.domElement)}getCountdown(){return Math.max(0,this.countdown)}hasStarted(){return this.raceStarted}getWinnerId(){return this.winnerId}freeze(){this.frozen=!0}unfreeze(){this.frozen=!1}setMuted(e){this.muted=e,this.applySettingsToAudio()}resetForReplay(e){this.winnerId=null,this.raceStarted=!1,this.frozen=!1,this.players.forEach(t=>{t.car.reset(new J(0,0,0),0)}),this.relineUpGrid(),this.finishGate&&this.finishGateBannerMat&&(this.finishGate.position.set(0,0,this.finishZ),this.finishGate.visible=!1,this.finishGateBannerMat.opacity=.12),this.countdownStartAt=e||Date.now(),this.countdown=3}getLocalId(){return this.localId}getLocalTransform(){const e=this.players.get(this.localId),t=e.car.group.position,s=e.car.group.quaternion;return{p:[t.x,t.y,t.z],q:[s.x,s.y,s.z,s.w]}}applyRemoteTransform(e,t,s){const a=this.players.get(e);if(!a||e===this.localId)return;const o=new J(t[0],t[1],t[2]),u=new pt(s[0],s[1],s[2],s[3]);a.car.group.position.lerp(o,.35),a.car.group.quaternion.slerp(u,.35)}getPlayerIds(){return Array.from(this.players.keys())}addPlayer(e){if(this.players.has(e.id))return;const t=new be({mass:1200,maxSpeed:40,acceleration:32,braking:60,handling:2.2,drag:.8,lateralGrip:8,reverseScale:.45,handbrakeGrip:.2,boost:{multiplier:1.35,capacity:6,drain:.45,regen:.22}});t.setPosition(0,0,0),t.setHeading(0),this.scene.add(t.group);const s=this.createNameLabel(e.name);t.group.add(s),s.position.set(0,1.8,0),this.players.set(e.id,{info:e,car:t,label:s}),this.raceStarted||this.relineUpGrid()}removePlayer(e){const t=this.players.get(e);if(t){try{this.scene.remove(t.car.group)}catch{}this.players.delete(e),this.raceStarted||this.relineUpGrid()}}getPlayerStates(){const e=[];return this.players.forEach((t,s)=>{e.push({id:s,name:t.info.name,z:t.car.group.position.z})}),e}relineUpGrid(){const e=Array.from(this.players.keys()),s=Math.min(4,Math.max(2,Math.ceil(Math.sqrt(e.length)))),a=2.8,o=5.4,u=-8;e.forEach((n,h)=>{const m=Math.floor(h/s),d=h%s,v=-((s-1)*a)/2+d*a,y=u-m*o-(m%2?.6:0),w=this.players.get(n);w.car.setPosition(v,0,y),w.car.setHeading(0)})}applySettingsToAudio(){const e=we(le);this.audio&&(this.muted?this.audio.updateFromSettings({audio:{master:0,engine:e.audio.engine,effects:e.audio.effects,music:e.audio.music,spatial:e.audio.spatial}}):this.audio.updateFromSettings(e))}createNameLabel(e){const t=document.createElement("canvas");t.width=256,t.height=96;const s=t.getContext("2d");s.clearRect(0,0,t.width,t.height);const a=18,o=t.width-a*2,u=56,n=12,h=12,m=a,d=(t.height-u-n)/2;let M=22;s.textAlign="center",s.textBaseline="middle",s.fillStyle="#fff";do{if(s.font=`700 ${M}px system-ui,-apple-system,Segoe UI,Roboto,sans-serif`,s.measureText(e).width<=o-a||M<=13)break;M-=1}while(M>13);const v=(I,_,A,D,U)=>{const W=Math.min(U,D/2,A/2);s.beginPath(),s.moveTo(I+W,_),s.arcTo(I+A,_,I+A,_+D,W),s.arcTo(I+A,_+D,I,_+D,W),s.arcTo(I,_+D,I,_,W),s.arcTo(I,_,I+A,_,W),s.closePath()};s.save(),s.shadowColor="rgba(0,0,0,0.35)",s.shadowBlur=8,s.shadowOffsetY=2,v(m,d,o,u,h),s.fillStyle="rgba(20,20,24,0.68)",s.fill(),s.restore();const y=m+o/2,w=d+u-1;s.beginPath(),s.moveTo(y-10,w),s.lineTo(y+10,w),s.lineTo(y,w+n),s.closePath(),s.fillStyle="rgba(20,20,24,0.68)",s.fill(),s.lineWidth=1,s.strokeStyle="rgba(255,255,255,0.18)",v(m,d,o,u,h),s.stroke(),s.fillStyle="#fff",s.fillText(e,t.width/2,d+u/2);const c=new oe(t);c.minFilter=ut;const g=new ft({map:c,transparent:!0,depthTest:!0,depthWrite:!1}),k=new mt(g),x=1.05,b=.35;return k.scale.set(x,b,1),k.userData={...k.userData,baseScale:{w:x,h:b}},k}createOrUpdateFinishGate(){const e=new wt,t=new re({color:2237994}),s=new re({color:2764596}),a=12,o=.6,u=.8,n=4.2,h=.5,m=.7,d=new Se(o,n,u),M=new K(d,t),v=new K(d,t);M.position.set(-a,n/2,0),v.position.set(a,n/2,0),e.add(M,v);const y=new Se(a*2+o,h,m),w=new K(y,s);w.position.set(0,n+h/2,0),e.add(w);const c=a*2-2,g=1.8,k=new yt(c,g);if(this.finishGateBannerMat){const b=this.makeFinishBannerTexture(20,4);b.wrapS=b.wrapT=Me,b.needsUpdate=!0,this.finishGateBannerMat.map=b,this.finishGateBannerMat.needsUpdate=!0}else{const b=this.makeFinishBannerTexture(20,4);b.wrapS=b.wrapT=Me,b.needsUpdate=!0,this.finishGateBannerMat=new re({map:b,transparent:!0,opacity:.12,depthWrite:!1,side:gt})}const x=new K(k,this.finishGateBannerMat);if(x.rotation.y=Math.PI,x.position.set(0,n-g/2,0),e.add(x),e.position.set(0,0,this.finishZ),e.visible=!1,this.finishGate)try{this.scene.remove(this.finishGate)}catch{}this.finishGate=e,this.scene.add(e)}makeCheckerTexture(e=8,t=2){const s=document.createElement("canvas");s.width=512,s.height=64;const a=s.getContext("2d"),o=s.width/e,u=s.height/t;for(let n=0;n<t;n++)for(let h=0;h<e;h++){const m=(n+h)%2===0;a.fillStyle=m?"#111":"#eee",a.fillRect(h*o,n*u,o,u)}return new oe(s)}makeFinishBannerTexture(e=20,t=4){const s=document.createElement("canvas");s.width=1024,s.height=256;const a=s.getContext("2d"),o=s.width/e,u=s.height/t;for(let v=0;v<t;v++)for(let y=0;y<e;y++){const w=(v+y)%2===0;a.fillStyle=w?"#111":"#eee",a.fillRect(y*o,v*u,o,u)}a.fillStyle="rgba(0,0,0,0.18)",a.fillRect(0,0,s.width,s.height);const n="FINISH";let h=180;const m=40;a.textAlign="center",a.textBaseline="middle";do{if(a.font=`900 ${h}px system-ui,-apple-system,Segoe UI,Roboto,sans-serif`,a.measureText(n).width<=s.width-m*2||h<=72)break;h-=4}while(h>72);a.save(),a.shadowColor="rgba(0,0,0,0.6)",a.shadowBlur=8,a.shadowOffsetY=4,a.lineWidth=Math.max(6,Math.floor(h*.06)),a.strokeStyle="rgba(0,0,0,0.9)",a.fillStyle="#ffffff";const d=s.width/2,M=s.height/2+6;return a.strokeText(n,d,M),a.fillText(n,d,M),a.restore(),new oe(s)}initializeGameMode(e){var t;switch(this.audio&&(e!=="horror"?this.audio.disableHorrorAmbient():(this.audio.enableHorrorAmbient(),this.startHorrorEffects())),(t=this.gameMode)==null||t.dispose(),e){case"sunny":this.gameMode=new St;break;case"cloudy":this.gameMode=new bt;break;case"horror":this.gameMode=new vt;break}this.gameMode.initialize(this.scene,this.renderer)}switchGameMode(e){this.initializeGameMode(e)}startHorrorEffects(){const e=()=>{if(!this.audio||!this.running)return;const t=8e3+Math.random()*17e3;setTimeout(()=>{if(!this.audio||!this.running)return;const s=["whisper","creak","distant-scream","heartbeat"],a=s[Math.floor(Math.random()*s.length)];this.audio.playHorrorEffect(a),e()},t)};e()}}class Tt{constructor(e,t,s,a){l(this,"ws",null);l(this,"url");l(this,"roomId");l(this,"playerId");l(this,"name");l(this,"reconnectDelay",1e3);l(this,"handlers",[]);l(this,"closed",!1);this.url=e,this.roomId=t,this.playerId=s,this.name=a||"Anonymous"}connect(){this.closed=!1,this.ws=new WebSocket(this.url),this.ws.onopen=()=>{this.emit({t:"open"}),this.send({t:"join",roomId:this.roomId,playerId:this.playerId,name:this.name})},this.ws.onmessage=e=>{try{const t=JSON.parse(e.data);if(!t||!t.t)return;this.emit(t)}catch{}},this.ws.onclose=()=>{this.emit({t:"close"}),this.closed||(setTimeout(()=>this.connect(),this.reconnectDelay),this.reconnectDelay=Math.min(this.reconnectDelay*2,8e3))},this.ws.onerror=()=>{}}emit(e){for(const t of this.handlers)try{t(e)}catch{}}close(){var e;this.closed=!0;try{(e=this.ws)==null||e.close()}catch{}}on(e){this.handlers.push(e)}send(e){var t;try{((t=this.ws)==null?void 0:t.readyState)===1&&this.ws.send(JSON.stringify(e))}catch{}}sendState(e,t){this.send({t:"state",p:e,q:t})}sendLeaderboard(e){this.send({t:"lb",list:e})}}var Gt=q('<div class="countdown svelte-lzoy4r"> </div>'),Bt=q('<div class="winner icon-text svelte-lzoy4r"><!> </div>'),Rt=q('<div class="lb-row svelte-lzoy4r"><span class="rank svelte-lzoy4r"> </span> <span class="name svelte-lzoy4r"> </span></div>'),Et=q('<div class="restart svelte-lzoy4r"><button class="restart-btn svelte-lzoy4r">Restart Race</button></div>'),Ct=q('<div class="game-root svelte-lzoy4r"></div> <!> <div class="hud svelte-lzoy4r"><a class="home-btn svelte-lzoy4r" aria-label="Home" title="Home" style="pointer-events:auto"><!> <span>Home</span></a> <!> <div class="speed svelte-lzoy4r"> </div> <div class="audio-controls svelte-lzoy4r" style="pointer-events:auto"><button class="mute-btn svelte-lzoy4r"> </button></div> <div class="leaderboard svelte-lzoy4r"><div class="lb-title svelte-lzoy4r">Participants</div> <!></div></div> <!>',1);function Jt(R,e){He(e,!1);const t=()=>Ye(Je,"$page",s),[s,a]=je(),o=H();let u=H(null),n=H(null),h=H(3),m=H(0),d=H(null),M=H([]),v=H(!1),y=H(!1),w,c=H(null);De(()=>{typeof document<"u"&&(document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden"),w=new Qe,z(c,null);const p=localStorage.getItem("playerName")||"Anonymous";i(u)&&(async()=>{var ue,fe;let r=await w.fetchRoom(i(o));if(!r)try{await w.joinRoom(i(o),p),r=await w.fetchRoom(i(o))}catch{}if(!r){alert("Room not found or no longer available."),history.back();return}const f=w.getPlayerId();if(!!!((ue=r.players)!=null&&ue[f])&&r.status==="waiting")try{await w.joinRoom(i(o),p),r=await w.fetchRoom(i(o))||r}catch{}const E=Object.values(r.players||{}).map(S=>({id:S.id,name:S.name||"Anonymous",isLocal:S.id===f})),C="wss://public_game_ws.realbrain.cc";z(c,new Tt(C,r.id,f,p)),i(c).connect(),z(n,new _t(i(u),E));const V=typeof r.raceStartAt=="number"?r.raceStartAt:void 0;i(n).init(V);const ae=setInterval(()=>{if(!i(n)||!i(c))return;const{p:S,q:F}=i(n).getLocalTransform();i(c).sendState(S,F)},66);(fe=i(c))==null||fe.on(S=>{if(i(n))if(S.t==="state")i(n).applyRemoteTransform(S.id,S.p,S.q);else if(S.t==="players"){const F=new Set(i(n).getPlayerIds()),Y=new Set(S.list.map(T=>T.id));S.list.forEach(T=>{F.has(T.id)||i(n).addPlayer({id:T.id,name:T.name,isLocal:T.id===f})}),F.forEach(T=>{Y.has(T)||i(n).removePlayer(T)})}else S.t==="lb"?z(M,S.list):S.t==="winner"?i(d)||(z(d,S.name||"Unknown"),z(v,!0)):S.t==="restart"&&(z(d,null),z(v,!1),i(n).resetForReplay(S.startAt))});const Ee=setInterval(()=>{var S,F,Y;if(i(n)){z(h,i(n).getCountdown()),z(m,Math.round(i(n).currentSpeed*3.6));const T=i(n).getWinnerId();T&&!i(d)&&(z(d,((S=E.find(Z=>Z.id===T))==null?void 0:S.name)||"Unknown"),(F=i(c))==null||F.send({t:"winner",id:T,name:i(d)}),z(v,!0));const me=i(n).getPlayerStates().sort((Z,ie)=>ie.z-Z.z).map((Z,ie)=>({...Z,rank:ie+1}));z(M,me),(Y=i(c))==null||Y.sendLeaderboard(me)}},100);x=w.subscribeToRoom(r.id,()=>{}),g=Ee,k=ae})()});let g=null,k=null,x=null;Pe(()=>{var p,r;(p=i(n))==null||p.destroy(),z(n,null),g&&clearInterval(g),k&&clearInterval(k),x&&x(),(r=i(c))==null||r.close(),typeof document<"u"&&(document.documentElement.style.overflow="",document.body.style.overflow="")});function b(p){var r,f;(f=(r=i(n))==null?void 0:r.input)==null||f.setMobileThrottle(p)}function I(p){var r,f;(f=(r=i(n))==null?void 0:r.input)==null||f.setMobileBrake(p)}function _(p){var r,f;(f=(r=i(n))==null?void 0:r.input)==null||f.setMobileSteer(p)}function A(p){var r,f;(f=(r=i(n))==null?void 0:r.input)==null||f.setMobileHandbrake(p)}function D(p){var r,f;(f=(r=i(n))==null?void 0:r.input)==null||f.setMobileBoost(p)}Le(()=>t(),()=>{z(o,t().params.roomId)}),We(),Ze();var U=Ct(),W=ce(U);Oe(W,p=>z(u,p),()=>i(u));var he=P(W,2);Mt(he,{onThrottle:b,onBrake:I,onSteer:_,onHandbrake:A,onBoost:D});var ee=P(he,2),X=G(ee),ze=G(X);zt(ze,{size:18}),Ue(2),B(X);var de=P(X,2);{var xe=p=>{var r=Gt(),f=G(r,!0);B(r),Q(()=>O(f,i(h))),N(p,r)},Ie=p=>{var r=ke(),f=ce(r);{var L=E=>{var C=Bt(),V=G(C);It(V,{size:20});var ae=P(V);B(C),Q(()=>O(ae,` Winner: ${i(d)??""}`)),N(E,C)};ne(f,E=>{i(d)&&E(L)},!0)}N(p,r)};ne(de,p=>{i(h)>0?p(xe):p(Ie,!1)})}var te=P(de,2),_e=G(te);B(te);var se=P(te,2),j=G(se),Te=G(j,!0);B(j),B(se);var pe=P(se,2),Ge=P(G(pe),2);Ne(Ge,1,()=>i(M),Ve,(p,r)=>{var f=Rt(),L=G(f),E=G(L);B(L);var C=P(L,2),V=G(C,!0);B(C),B(f),Q(()=>{O(E,`${i(r),ge(()=>i(r).rank)??""}.`),O(V,(i(r),ge(()=>i(r).name)))}),N(p,f)}),B(pe),B(ee);var Be=P(ee,2);{var Re=p=>{var r=Et(),f=G(r);B(r),ye("click",f,()=>{var E,C;const L=Date.now()+3e3;(E=i(c))==null||E.send({t:"restart",startAt:L}),(C=i(n))==null||C.resetForReplay(L),z(d,null),z(v,!1)}),N(p,r)};ne(Be,p=>{i(d)&&i(v)&&p(Re)})}Q(()=>{ve(X,"href",`${kt}/`),O(_e,`${i(m)??""} km/h`),ve(j,"aria-pressed",i(y)),O(Te,i(y)?"Unmute":"Mute")}),ye("click",j,()=>{var p;z(y,!i(y)),(p=i(n))==null||p.setMuted(i(y))}),N(R,U),$e(),a()}export{Jt as component};
